LABS ?= $(shell cd templates && find -mindepth 1 -maxdepth 1 -type d)
MODS = $(shell cd templates && find $(LABS) -mindepth 1 -name Kbuild | xargs dirname)
TODO ?= 0

skels:
	mkdir -p skels
	cd templates && find $(LABS) -type f | xargs ./generate_skels.py --output ../skels --todo $(TODO)
	rm -f skels/Kbuild

skels/Kbuild:
	echo "# autogenerated, do not edit " > $@
	echo "ccflags-y += -Wno-unused-function -Wno-unused-label -Wno-unused-variable " >> $@
	for i in $(shell cd skels && find -mindepth 1 -name Kbuild | xargs --no-run-if-empty dirname); do echo "obj-m += $$i/" >> $@; done